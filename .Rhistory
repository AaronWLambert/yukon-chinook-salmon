)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
(MMPIC_plot <- env.df %>%
ggplot(aes(x = pic.mean, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "PSS Chinook Salmon Passage Midpoint",
x = "MMPIC")
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
theme_pubclean()+
theme(text = element_text(size = 16))
(MMSST_plot <- env.df %>%
ggplot(aes(x = sst, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MMSST~(`degree`*C)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
plot_grid(MMSST_plot,MMPIC_plot,MAAT_plot, labels = "AUTO", ncol = 1, hjust = -2)
(MAAT_plot <- env.df %>%
ggplot(aes(x = air.mean, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MAAT~(`degree`*F)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
theme_pubclean()+
theme(text = element_text(size = 16))
(MMPIC_plot <- env.df %>%
ggplot(aes(x = pic.mean, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "PSS Chinook Salmon Passage Midpoint",
x = "MMPIC")
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
theme_pubclean()+
theme(text = element_text(size = 16))
(MMSST_plot <- env.df %>%
ggplot(aes(x = sst, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MMSST~(`degree`*C)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
plot_grid(MMSST_plot,MMPIC_plot,MAAT_plot, labels = "AUTO", ncol = 1, hjust = -2)
# Fit a model with all three covariates
fit.env.full <- lm(data = env.df[env.df$year >= 2000,], mid ~ sst + air.mean + pic.mean)
plot_grid(MMSST_plot,MMPIC_plot,MAAT_plot,
labels = "AUTO", align = "v",
ncol = 1,
hjust = -2)
(MMPIC_plot <- env.df %>%
ggplot(aes(x = pic.mean, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "PSS Chinook Salmon Passage Midpoint",
x = "MMPIC")
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
theme_pubclean()+
theme(text = element_text(size = 16),
axis.title.y = element_text(hjust = 2))
(MMPIC_plot <- env.df %>%
ggplot(aes(x = pic.mean, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "PSS Chinook Salmon Passage Midpoint",
x = "MMPIC")
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
theme_pubclean()+
theme(text = element_text(size = 16),
axis.title.y = element_text(vjust = 2))
(MMPIC_plot <- env.df %>%
ggplot(aes(x = pic.mean, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "PSS Chinook Salmon Passage Midpoint",
x = "MMPIC")
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
theme_pubclean()+
theme(text = element_text(size = 16),
axis.title.y = element_text(vjust = 5))
(MMSST_plot <- env.df %>%
ggplot(aes(x = sst, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MMSST~(`degree`*C)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
plot_grid(MMSST_plot,MMPIC_plot,MAAT_plot,
labels = "AUTO", align = "v",
ncol = 1,
hjust = -2)
plot_grid(MMSST_plot,MMPIC_plot,MAAT_plot,
labels = "AUTO", align = "v",
ncol = 1,
hjust = -2, )+theme_bw()
plot_grid(MMSST_plot,MMPIC_plot,MAAT_plot,
labels = "AUTO", align = "v",
ncol = 1,
hjust = -2)+theme_bw()
(MMSST_plot <- env.df %>%
ggplot(aes(x = sst, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MMSST~(`degree`*C)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
ggarrange(MMSST_plot,MMPIC_plot,MAAT_plot)
(MMSST_plot <- env.df %>%
ggplot(aes(x = sst, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MMSST~(`degree`*C)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
ggarrange(MMSST_plot,MMPIC_plot,MAAT_plot)+theme_bw()
plot_grid(MMSST_plot,MMPIC_plot,MAAT_plot,
labels = "AUTO", align = "v",
ncol = 1,
hjust = -2)
ggarrange(MMSST_plot,MMPIC_plot,MAAT_plot)+theme_bw()
ggarrange(MMSST_plot,MMPIC_plot,MAAT_plot)
ggarrange(MMSST_plot,MMPIC_plot,MAAT_plot)
MMSST_plot
(MMSST_plot <- env.df %>%
ggplot(aes(x = sst, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MMSST~(`degree`*C)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
MMSST_plot
(MMSST_plot <-
ggplot(env.df,aes(x = sst, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MMSST~(`degree`*C)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
MMSST_plot
library(tidyverse)
library(ggpubr)
library(Hmisc)
# set to working directory
wd <- "C:/Users/aaron/Desktop/Yukon Kings/Inseason Forcast Model"
setwd(wd)
# Objects used to save/load data, outputs, or stan/R scripts
dir.output <- file.path(wd,"output")
dir.figs <- file.path(wd,"figs")
dir.stan <- file.path(wd,"Stan")
dir.data <- file.path(wd,"Data")
dir.R <- file.path(wd,"R")
#  If not using Dataframe preprocess.R, uncomment out the following to load relevant PSS historical data
PSS_hist <- readRDS(file = file.path(dir.data,"PSS passage Final 2022.RDS"))
# This is the reconstructed data from Curry for old reconstructed modeling procedure
CAN_hist <- readRDS(file.path(dir.data,"Canadian Passage RR 21Mar23.RDS"))
# Midpoint from logistic curve fitting 1995-2022
all.timing.logistic <- read.csv(file = file.path(dir.output,"logistic curve parameters All Chinook 1995_2022.csv"))
# PIC from NOAA ERDDAP, cleaned and ready to use. V2
# pic.df <- readRDS(file = file.path(dir.data,"Norton Ice 18July23.RDS")) # Mean over whole grid
pic.df <- readRDS(file = file.path(dir.data,"ICE Point -168625_63125 2000_2022.RDS")) # Mean for one grid cell in May
# SST from NOAA ERDDAP, cleaned and ready to use. V2
# sst.df <- readRDS(file = file.path(dir.data,"norton.sst 6Apr23"))# Mean over whole grid
sst.df <- readRDS(file = file.path(dir.data,"SST Point -164875_62625 2000_2022.RDS")) # Mean for one grid cell in May
# Emmonak Air Temp
air.df <- readRDS(file = file.path(dir.data,"Emmonak Mean Month Temp 12Apr23.RDS"))
# Rename some columns...
sst.df <- sst.df %>% rename(sst = month.mean)
pic.df <- pic.df %>% rename(pic.mean = mean.ice)
air.df <- air.df %>% rename(year = Year,
air.mean = mean_month_temp) %>%
filter(month==4)
env.df <-left_join(air.df[,-2],pic.df[,c(3,4)], by = c("year"))
env.df <- left_join(env.df,sst.df, by = c("year"))
# Visually look at the correlations
plot(env.df)
# Use rcorr to handle missing year
env.cor <- rcorr(as.matrix(env.df))
#Use this function to flatten the results for easier analysis
# cormat : matrix of the correlation coefficients
# pmat : matrix of the correlation p-values
flattenCorrMatrix <- function(cormat, pmat) {
ut <- upper.tri(cormat)
data.frame(
row = rownames(cormat)[row(cormat)[ut]],
column = rownames(cormat)[col(cormat)[ut]],
cor  =(cormat)[ut],
p = pmat[ut]
)
}
(env.corr.flat <- flattenCorrMatrix(cormat = env.cor$r, pmat = env.cor$P))
# Pivot long for facet_grid
masterDF2 <- env.df %>% pivot_longer(cols = c(sst, pic.mean, air.mean),names_to = "Env_Cov", values_to = "Value")
# Interpolate missing air year 2020 ############################################
plot(env.df$air.mean~env.df$sst)
# Fit a linear model
fit.int <- lm(env.df$air.mean~env.df$sst)
summary(fit.int)
# Use the coefficients to estimate year 2020
int.air <- coef(fit.int)[1]+coef(fit.int)[2]*env.df$sst[env.df$year==2020]
# replace NA's in Ice data with zeros as these are years with no ice cover in May
#  at the lon-lat position
env.df$pic.mean[is.na(env.df$pic.mean)] <- 0
# Pivot longer to plot
mast.lm.df_long <- env.df %>% pivot_longer(cols = c(air.mean, pic.mean ,sst),
values_to = "Value",
names_to = "Cov")
# Plot the relationship for all years
ggplot(mast.lm.df_long[mast.lm.df_long$year >= 2000,],
aes( x = Value, y = mid, label = year))+
geom_point()+
geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.3,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "PSS Chinook Salmon Passage Midpoint"
)+
facet_wrap(~Cov, scales = "free_x",
labeller = as_labeller(c(`air.mean`= "MAAT",
`pic.mean` = "MMPIC",
`sst` = "MMSST")),
ncol = 3)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
theme_pubclean()+
theme(text = element_text(size = 16))
(MAAT_plot <- env.df %>%
ggplot(aes(x = air.mean, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MAAT~(`degree`*F)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
theme_pubclean()+
theme(text = element_text(size = 16))
(MMPIC_plot <- env.df %>%
ggplot(aes(x = pic.mean, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "PSS Chinook Salmon Passage Midpoint",
x = "MMPIC")
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
theme_pubclean()+
theme(text = element_text(size = 16),
axis.title.y = element_text(vjust = 5))
(MMSST_plot <-
ggplot(env.df,aes(x = sst, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MMSST~(`degree`*C)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
plot_grid(MMSST_plot,MMPIC_plot,MAAT_plot,
labels = "AUTO", align = "v",
ncol = 1,
hjust = -2)
ggarrange(MMSST_plot,MMPIC_plot,MAAT_plot)
MMSST_plot
(MMSST_plot <-
ggplot(env.df,aes(x = sst, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MMSST~(`degree`*C)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
MMSST_plot
(MMSST_plot <-
ggplot(env.df,aes(x = sst, y = mid))+
geom_point()+
# geom_text(nudge_y = 0.5, size = 2)+
geom_smooth(method = "lm",col = "red", alpha = .5)+
stat_cor(aes(label = paste(..rr.label.., ..p.label.., sep = "~`,`~")),
size = 4,
label.y = 181,label.x.npc = 0.5,
# label.x = c(20,1,2),
na.rm = T)+
labs(y = "",
# y = "PSS Chinook Salmon Passage Midpoint",
x = expression(~MMSST~(`degree`*C)))
)+
scale_y_continuous(breaks = c(170,174,178,182), labels = c("Jun 19",
"Jun 23",
"Jun 27",
"Jul 1"))+
scale_x_continuous(breaks = c(-1,0,1,2,3,4,5,6))+
theme_pubclean()+
theme(text = element_text(size = 16))
MMSST_plot
plot_grid(MMSST_plot,MMPIC_plot,MAAT_plot,
labels = "AUTO", align = "v",
ncol = 1,
hjust = -2)
ggarrange(MMSST_plot,MMPIC_plot,MAAT_plot)
